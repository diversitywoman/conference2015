/*
 * Eventbrite API client (jQuery required) - https://github.com/ryanjarvinen/Eventbrite.jquery.js
 *///Constructor
var Eventbrite=function(){"use strict";var e={},t=Array.prototype.slice.call(arguments),n=t.pop();typeof t[0]=="object"?e=t[0]:typeof t[0]=="function"||t[0]===undefined?e.access_token=Eventbrite.prototype.data.getAccessToken():(e.app_key=t[0],typeof t[1]!="function"&&(typeof t[2]!="function"?(e.user=t[1],e.password=t[1]):e.user_key=t[1]));if(!(this instanceof Eventbrite))return new Eventbrite(e,n);this.auth_tokens=e,n(this)};Eventbrite.prototype={api_host:"https://developer.eventbrite.com/json/",api_methods:["discount_new","discount_update","event_copy","event_get","event_list_attendees","event_list_discounts","event_new","event_search","event_update","organizer_list_events","organizer_new","organizer_update","organizer_get","payment_update","ticket_new","ticket_update","user_get","user_list_events","user_list_organizers","user_list_tickets","user_list_venues","user_new","user_update","venue_new","venue_get","venue_update"],request:function(e,t,n){var r={};typeof t=="function"?(n=t,t={}):t===undefined&&(t={}),this.auth_tokens.access_token===undefined?(this.auth_tokens.app_key&&(t.app_key=this.auth_tokens.app_key),this.auth_tokens.user_key&&(t.user_key=this.auth_tokens.user_key),this.auth_tokens.user&&(t.user=this.auth_tokens.user),this.auth_tokens.password&&(t.password=this.auth_tokens.password)):(r={Authorization:"Bearer "+this.auth_tokens.access_token},t.access_token=this.auth_tokens.access_token),$.ajax({url:this.api_host+e,data:t,type:"GET",dataType:"jsonp",headers:r,beforeSend:function(e){e.setRequestHeader("Content-Type","application/json"),e.setRequestHeader("Accept","application/json"),t.access_token!==undefined&&e.setRequestHeader("Authorization","Bearer "+t.access_token)},success:function(e){e.contents!==undefined?n(e.contents):n(e)},failure:function(e){console.log("Error connecting to Eventbrite API")}})},utils:{eventList:function(e,t,n){var r=['<div class="eb_event_list">'];if(e.events!==undefined){var i=e.events.length;for(var s=0;s<i;s++)e.events[s].event!==undefined&&r.push(t(e.events[s].event,n))}else r.push("No events are available at this time.");return r.push("</div>"),r.join("\n")},eventListRow:function(e){var t=/\d\d-\d\d-\d\d \d\d:\d\d:\d\d/,n=t.test(e.start_date)?e.start_date.replace(" ","T"):e.start_date,r=new Date(Date.parse(n)),i="Online",s=Eventbrite.prototype.utils.formatTime(r),o="";return n=r.toDateString(),e.venue!==undefined&&e.venue.name!==undefined&&e.venue.name!==""&&(i=e.venue.name),o="<div class='eb_event_list_item' id='evnt_div_"+e.id+"'>"+"<span class='eb_event_list_title'><a href='"+e.url+"'>"+e.title+"</a></span>"+"<span class='eb_event_list_date'>"+n+"</span><span class='eb_event_list_time'>"+s+"</span>"+"<span class='eb_event_list_location'>"+i+"</span></div>",o},formatTime:function(e){var t="",n=e.getMinutes(),r=e.getHours(),i="am";return n<10&&(n="0"+n),r===0?r=12:r>=12&&(i="pm",r!==12&&(r-=12)),t+=r+":"+n+i},login:function(e,t){var n={};e.error_message!==undefined&&(e.error_message==="access_denied"?n.login_error="Account access denied.":e.error_message!=="disabled"&&(n.login_error=e.error_message)),e.access_token===undefined&&(typeof e.get_token=="function"?e.access_token=e.get_token():e.get_token!=="disabled"&&(e.access_token=Eventbrite.prototype.data.getAccessToken()));try{Eventbrite({access_token:e.access_token},function(e){var r=e.user_get(function(e){return e!==undefined&&e.user!==undefined&&(n.user_email=e.user.email,n.user_name=e.user.first_name+" "+e.user.last_name),t(n)})})}catch(r){return n.login_error=r,typeof e.delete_token=="function"?e.delete_token(e.access_token):e.delete_token!=="disabled"&&Eventbrite.prototype.data.deleteAccessToken(e.access_token),t(n)}},logoutLink:function(){return Eventbrite.prototype.utils.logout},logout:function(e){Eventbrite.prototype.data.deleteAccessToken(),Eventbrite.prototype.widget.login({app_key:e},function(e){$(".eb_login_widget").replaceWith(e)})},oauthLink:function(e){return"https://www.eventbrite.com/oauth/authorize?response_type=token&client_id="+e},isLoggedIn:function(){var e=Eventbrite.prototype.data.getAccessToken(),t=e!==undefined&&e!=="undefined";return t}},data:{getAccessToken:function(){return localStorage.eb_access_token},saveAccessToken:function(e){localStorage.eb_access_token=e},deleteAccessToken:function(e){localStorage.eb_access_token=undefined}},widget:{login:function(e,t){window.location.hash.indexOf("token_type=Bearer")!==-1&&window.location.hash.indexOf("access_token=")!==-1&&e.access_token===undefined&&(window.location.hash.slice(window.location.hash.indexOf("access_token=")+13).indexOf("&")!==-1?access_token=window.location.hash.slice(window.location.hash.indexOf("access_token=")+13,window.location.hash.indexOf("access_token=")+13+window.location.hash.slice(window.location.hash.indexOf("access_token=")+13).indexOf("&")):access_token=window.location.hash.slice(window.location.hash.indexOf("access_token=")+13),access_token!==-1&&access_token!==""&&e.save_token!=="disabled"&&(typeof e.save_token=="function"?e.save_token(access_token):Eventbrite.prototype.data.saveAccessToken(access_token),e.access_token=access_token,window.location.hash="#")),e.access_token===undefined&&e.get_token!=="disabled"&&(typeof e.get_token=="function"?e.access_token=e.get_token():e.access_token=Eventbrite.prototype.data.getAccessToken()),e.error_message!==undefined&&e.error_message=="disabled"?delete e.error_message:e.error_message!=="disabled"&&window.location.search.indexOf("error=")!==-1&&(window.location.search.slice(window.location.search.indexOf("error=")+6).indexOf("&")!==-1?e.error_message=window.location.search.slice(window.location.search.indexOf("error=")+6,window.location.search.indexOf("error=")+6+window.location.search.slice(window.location.search.indexOf("error=")+6).indexOf("&")):e.error_message=window.location.search.slice(window.location.search.indexOf("error=")+6)),Eventbrite.prototype.utils.login(e,function(n){var r={};return e.logout_link!=="disabled"&&(r.logout_link=e.logout_link),r.oauth_link=e.oauth_link,r.oauth_link===undefined&&(r.oauth_link=Eventbrite.prototype.utils.oauthLink(e.app_key)),r.logout_link===undefined&&(r.logout_link="Eventbrite.prototype.utils.logout('"+e.app_key+"');"),n!==undefined&&typeof n=="object"&&(n.user_email!==undefined&&(r.user_name=n.user_name,r.user_email=n.user_email),n.login_error!==undefined&&(r.login_error=n.login_error)),typeof e.renderer=="function"?t(e.renderer(r)):e.renderer=="disabled"?t(r):t(Eventbrite.prototype.widget.loginHTML(r))})},loginHTML:function(e){return html=["<div class='eb_login_widget'>"],html.push("<style type='text/css'>.eb_login_btn{width:162px;height:24px;display:block;text-indent: -99999px;background: url('http://evbdn.eventbrite.com/s3-s3/static/images/developer/oauth2/oauth-connect-btns.png') top;}\n.eb_login_btn:hover{background-position: 0px 24px;} .eb_logout{text-align:right;}</style>"),e.user_name!==undefined&&e.user_email!==undefined&&e.logout_link!==undefined?(html.push("<div><p><b>Welcome Back!</b></p>"),html.push("<p>You are logged in as:<br/>"+e.user_name+"<br/><i>("+e.user_email+")</i></p>"),e.logout_link!=="disabled"&&html.push("<p class='eb_logout'><a class='button' href='#' onclick=\""+e.logout_link+'">Logout</a></p>'),html.push("</div>")):e.oauth_link!==undefined?(e.login_error!==undefined&&html.push("<p class='error'>"+e.login_error+"</p>"),html.push("<p><a class='eb_login_btn' target='_top' href='"+e.oauth_link+"'>Connect to Eventbrite</a></p>")):html.push("<div><b>Eventbrite widgetHTML template example fail :(</b></div>"),html.push("</div>"),html.join("\n")},ticket:function(e){return'<div style="width:100%; text-align:left;"><iframe  src="http://www.eventbrite.com/tickets-external?eid='+e.id+'&ref=etckt" frameborder="0" height="192" width="100%" vspace="0" hspace="0" marginheight="5" marginwidth="5" scrolling="auto" allowtransparency="true"></iframe><div style="font-family:Helvetica, Arial; font-size:10px; padding:5px 0 5px; margin:2px; width:100%; text-align:left;"><a style="color:#ddd; text-decoration:none;" target="_blank" href="http://www.eventbrite.com/r/etckt">Online Ticketing</a><span style="color:#ddd;"> for </span><a style="color:#ddd; text-decoration:none;" target="_blank" href="http://www.eventbrite.com/event/'+e.id+'?ref=etckt">'+e.title+'</a><span style="color:#ddd;"> powered by </span><a style="color:#ddd; text-decoration:none;" target="_blank" href="http://www.eventbrite.com?ref=etckt">Eventbrite</a></div></div>'},registration:function(e){return'<div style="width:100%; text-align:left;"><iframe  src="http://www.eventbrite.com/event/'+e.id+'?ref=eweb" frameborder="0" height="1000" width="100%" vspace="0" hspace="0" marginheight="5" marginwidth="5" scrolling="auto" allowtransparency="true"></iframe><div style="font-family:Helvetica, Arial; font-size:10px; padding:5px 0 5px; margin:2px; width:100%; text-align:left;"><a style="color:#ddd; text-decoration:none;" target="_blank" href="http://www.eventbrite.com/r/eweb">Online Ticketing</a><span style="color:#ddd;"> for </span><a style="color:#ddd; text-decoration:none;" target="_blank" href="http://www.eventbrite.com/event/'+e.id+'?ref=eweb">'+e.title+'</a><span style="color:#ddd;"> powered by </span><a style="color:#ddd; text-decoration:none;" target="_blank" href="http://www.eventbrite.com?ref=eweb">Eventbrite</a></div></div>'},calendar:function(e){return'<div style="width:195px; text-align:center;"><iframe  src="http://www.eventbrite.com/calendar-widget?eid='+e.id+'" frameborder="0" height="382" width="195" marginheight="0" marginwidth="0" scrolling="no" allowtransparency="true"></iframe><div style="font-family:Helvetica, Arial; font-size:10px; padding:5px 0 5px; margin:2px; width:195px; text-align:center;"><a style="color:#ddd; text-decoration:none;" target="_blank" href="http://www.eventbrite.com/r/ecal">Online event registration</a><span style="color:#ddd;"> powered by </span><a style="color:#ddd; text-decoration:none;" target="_blank" href="http://www.eventbrite.com?ref=ecal">Eventbrite</a></div></div>'},countdown:function(e){return'<div style="width:195px; text-align:center;"><iframe  src="http://www.eventbrite.com/countdown-widget?eid='+e.id+'" frameborder="0" height="479" width="195" marginheight="0" marginwidth="0" scrolling="no" allowtransparency="true"></iframe><div style="font-family:Helvetica, Arial; font-size:10px; padding:5px 0 5px; margin:2px; width:195px; text-align:center;"><a style="color:#ddd; text-decoration:none;" target="_blank" href="http://www.eventbrite.com/r/ecount">Online event registration</a><span style="color:#ddd;"> for </span><a style="color:#ddd; text-decoration:none;" target="_blank" href="http://www.eventbrite.com/event/'+e.id+'?ref=ecount">'+e.title+"</a></div></div>"},button:function(e){return'<a href="http://www.eventbrite.com/event/'+e.id+'?ref=ebtn" target="_blank"><img border="0" src="http://www.eventbrite.com/custombutton?eid='+e.id+'" alt="Register for '+e.title+' on Eventbrite" /></a>'},link:function(e,t,n){return'<a href="http://www.eventbrite.com/event/'+e.id+'?ref=elink" target="_blank" style="color:'+(n||"#000000")+';">'+(t||e.title)+"</a>"}}},function(){function t(e){Eventbrite.prototype[e]=function(t,n){this.request(e,t,n)}}var e=Eventbrite.prototype.api_methods.length;for(var n=0;n<e;n+=1)t(Eventbrite.prototype.api_methods[n])}(),function(e,t){var n=e.parse,r=[1,4,5,6,7,10,11];e.parse=function(i){var s,o,u=0;if(o=/^(\d{4}|[+\-]\d{6})(?:-(\d{2})(?:-(\d{2}))?)?(?:T(\d{2}):(\d{2})(?::(\d{2})(?:\.(\d{3}))?)?(?:(Z)|([+\-])(\d{2})(?::(\d{2}))?)?)?$/.exec(i)){for(var a=0,f;f=r[a];++a)o[f]=+o[f]||0;o[2]=(+o[2]||1)-1,o[3]=+o[3]||1,o[8]!=="Z"&&o[9]!==t&&(u=o[10]*60+o[11],o[9]==="+"&&(u=0-u)),s=e.UTC(o[1],o[2],o[3],o[4],o[5]+u,o[6],o[7])}else s=n?n(i):NaN;return s}}(Date);